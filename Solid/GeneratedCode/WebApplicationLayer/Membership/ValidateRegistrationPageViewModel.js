////////////////////////////////////////////////////////////////////////////////////////////
// This is Generated Code
// You should not modify this code as it may be overwritten. Use Partial classes instead
// Generated By Generative Objects  
//////////////////////////////////////////////////////////////////////////////////////////// 
(function () {
    // 
    Solid.Web.Membership.ValidateRegistrationPageViewModel = function () {
        var self = this;

        this.securityProviderProxy = new Solid.Web.Model.Components.GOSecurityProviderProxy(this.ObjectsDataSet);

        this.data = {
			token: ko.observable(null),
			errorMessage: ko.observable(""),
			validateRegistrationFailed: ko.observable(false),
			loginLink: ko.observable("./Login.html"),
        };

        this.commands = {
            validateRegistration: function () {
                self.validateRegistration();
            },
			validateRegistrationText: ko.observable(Solid.Web.Messages.validate),
			validateRegistrationEnabled: ko.observable(true)
        };

		this.validateRegistration = function () {
			$(':input').trigger('change');
			
			var configuration = {};
			configuration.token = window.location.href.split("key=")[1];

			configuration.successHandler = self.onValidateRegistrationSucceeded;
			configuration.errorHandler = self.onValidateRegistrationError;
		
			self.commands.validateRegistrationText(Solid.Web.Messages.validating);
			self.commands.validateRegistrationEnabled("false");

			self.securityProviderProxy.ValidateRegistration(configuration);
		};

		this.onValidateRegistrationSucceeded = function (token) {
			window.location = Solid.Web.Application.BaseURL 
				+ "/Membership/HoldingPage.html?title=accountCreation&message=emailVerified&login=true"
				;
        };

		this.onValidateRegistrationError = function (error) {
			self.commands.validateRegistrationText(Solid.Web.Messages.validate);
			self.commands.validateRegistrationEnabled("true");
			self.data.token(null);    
			self.data.errorMessage(error);
			self.data.validateRegistrationFailed(true);
		};
		
		// Apply bindings
		ko.applyBindings(self, $("#Main").get(0));
    };
}());