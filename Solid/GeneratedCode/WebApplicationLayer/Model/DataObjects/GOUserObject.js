////////////////////////////////////////////////////////////////////////////////////////////
// This is Generated Code
// You should not modify this code as it may be overwritten. Use Partial classes instead
// Generated By Generative Objects  
//////////////////////////////////////////////////////////////////////////////////////////// 

(function () {
	'use strict';
	
	/// <summary>
	/// DataObject class for the entity 'GOUser'.
	/// </summary>
	Solid.Web.Model.DataObjects.GOUserObject = function(rootobject) {
		var self = this;
		
		this._objectType = "GOUser";
		
		// Dealing with memory
		this.subscriptions = [];
		this.ko_computed = [];
		this.IsReleased = false;

	
		// GOUserObject Data
		this.Data = {
			// PK fields
			Id: ko.observable(Math.uuid()),
			Id_OldValue: ko.observable(Math.uuid()),	
			
			// Relation	fields (navigators + FK temporary keys observable if needed)
			UserGroupItems: function () { return self.getUserGroupItems(); },
 			UserRoleItems: function () { return self.getUserRoleItems(); },
 		
			// Other fields
			Blocked: ko.observable(),
			EmailAddress: ko.observable(null),
			EmailValidated: ko.observable(),
			FirstName: ko.observable(null),
			FullName: ko.observable(null),
			LastName: ko.observable(null),
			Password: ko.observable(null),
			PasswordExpiry: ko.observable(),
			Unregistered: ko.observable(),
			UserName: ko.observable(null),
			UserValidated: ko.observable(),
			// State attributes
			InternalObjectId: ko.observable(null),

			// IsDirty indicates weither the data objects has to be persisted
			IsDirty: ko.observable(true),
			IsNew: ko.observable(true),
			IsMarkedForDeletion: ko.observable(false)
		};

		// Computed
		this.ko_computed.push(this.Data.PrimaryKey = ko.pureComputed(ComputedPKForGOUser, this));

		this.ko_computed.push(this.Data.PasswordExpiry_DisplayString = ko.pureComputed(formatDateForPasswordExpiry, this));	
		this.ko_computed.push(this.Data.PasswordExpiry_WithTimeDisplayString = ko.pureComputed(formatDateForPasswordExpiryWithTime, this));
 
		// timezone adjustment
		// Currently not doing anything useful, left in as a placeholder for future expansion (if e.g. we support showing dates in user-specified timezones)
		this.getTimezoneAdjustedDate = function (fieldName, isAbsolute) {
			return GO.GetDisplayDate(self.Data[fieldName](), 0, isAbsolute);
		};

		// Validation control
		this.StatusData = {
			isBlockedValid: ko.observable(true),
			blockedErrorMessage: ko.observable(null), 
			isEmailAddressValid: ko.observable(true),
			emailAddressErrorMessage: ko.observable(null), 
			isEmailValidatedValid: ko.observable(true),
			emailValidatedErrorMessage: ko.observable(null), 
			isFirstNameValid: ko.observable(true),
			firstNameErrorMessage: ko.observable(null), 
			isFullNameValid: ko.observable(true),
			fullNameErrorMessage: ko.observable(null), 
			isIdValid: ko.observable(true),
			idErrorMessage: ko.observable(null), 
			isLastNameValid: ko.observable(true),
			lastNameErrorMessage: ko.observable(null), 
			isPasswordValid: ko.observable(true),
			passwordErrorMessage: ko.observable(null), 
			isPasswordExpiryValid: ko.observable(true),
			passwordExpiryErrorMessage: ko.observable(null), 
			isUnregisteredValid: ko.observable(true),
			unregisteredErrorMessage: ko.observable(null), 
			isUserGroupItemsValid: ko.observable(true),
			userGroupItemsErrorMessage: ko.observable(null), 
			isUserNameValid: ko.observable(true),
			userNameErrorMessage: ko.observable(null), 
			isUserRoleItemsValid: ko.observable(true),
			userRoleItemsErrorMessage: ko.observable(null), 
			isUserValidatedValid: ko.observable(true),
			userValidatedErrorMessage: ko.observable(null), 
			IsUserNameReadOnly: ko.observable(),
			
			// Used for Custom Validation Rules
			isGOUserEntityValid: ko.observable(true),
			gOUserEntityErrorMessage: ko.observable(null),
			errorSummary: ko.observableArray(),
			lastEditedTime: ko.observable(new Date().getTime())
		};

		// Overall validity
		this.ko_computed.push(this.StatusData.isValid = ko.pureComputed(statusDataValidationComputed, this));

		/**********************************/
		/****** ADDITIONNAL FIELDS ********/
		/**********************************/

		// Dataset
		//this.datasetClone = null;
        this.ObjectsDataSet = null;
        this.contextIds = [];
		
		// Dependencies		
        this.isInUpdateDependentCustomValues = false;
        this.DirtyHandlerOn = true;
        this.notifyChangesOn = true;
		this.onPropertyChangedHandlers = [];

		this.initialize();
	};

	// Overriding default toString with the Title field set
	Solid.Web.Model.DataObjects.GOUserObject.prototype.toString = function() {
		return this.Data.UserName();
	};

	/****************************************/
    /****** PROPERTY CHANGE HANDLING ********/
    /****************************************/

 
	// DateTime handling
	Solid.Web.Model.DataObjects.GOUserObject.prototype.setDateTimeFromJSON = function(prop, date) {

		if (!date || !date.Date)
			return;

		if (!this.Data[prop])
			return;
 
		// PasswordExpiry is received from server as UTC (timezone offset information is 'lost' currently)
		// So offset from UTC using the local timezone offset had the offset been applied 'at the time' the date was set
		if (prop === "PasswordExpiry") {
			date.Date = date.Date.addMinutes(-date.Date.getTimezoneOffset());
		}
 
		this.Data[prop](date.Date);
	};

	// Triggers for Business Rules ReadOnly dependency
	Solid.Web.Model.DataObjects.GOUserObject.prototype.updateIsUserNameReadOnlyValue = function() {
		this.StatusData.IsUserNameReadOnly(!(this.Data.IsNew()));
	};
		
	Solid.Web.Model.DataObjects.GOUserObject.prototype.addOnPropertyChangedHandler = function( handler ) {
		this.onPropertyChangedHandlers.push(handler);
	};

	Solid.Web.Model.DataObjects.GOUserObject.prototype.removeOnPropertyChangedHandler = function( handler ) {
		for (var i = 0; i < this.onPropertyChangedHandlers.length; i++) {
			if (this.onPropertyChangedHandlers[i] === handler) {
				this.onPropertyChangedHandlers.splice(i,1);
				i--;
			}
		}
	};

	Solid.Web.Model.DataObjects.GOUserObject.prototype.onPropertyChanged = function (propertyName, callers) {
		if (this.notifyChangesOn === false)
			return;

		var localPropertyName = propertyName;
			
		// This is to avoid infinite loops: in case a caller receives back a property changed notification it has initially sent
        if (!callers) {
			callers = [];
		}
			
        var callerIndex = callers.indexOf(this);
		if (callerIndex !== -1)
        {
			return;
        }
			
		callers.push(this);
			
		
		// Push the notification to related objects			
		var userGroupItemsItems = this.Data.UserGroupItems();

		if (userGroupItemsItems !== null && userGroupItemsItems) {
			for (var i=0; i < userGroupItemsItems.length; i++) {
				userGroupItemsItems[i].onPropertyChanged("User." + localPropertyName, callers);
			}
		}

		var userRoleItemsItems = this.Data.UserRoleItems();

		if (userRoleItemsItems !== null && userRoleItemsItems) {
			for (var i=0; i < userRoleItemsItems.length; i++) {
				userRoleItemsItems[i].onPropertyChanged("User." + localPropertyName, callers);
			}
		}

		for (var i = 0; i < this.onPropertyChangedHandlers.length; i++) {
			this.onPropertyChangedHandlers[i](localPropertyName);
		}
	};

		
    /*************************/
    /****** RELATIONS ********/
    /*************************/

	Solid.Web.Model.DataObjects.GOUserObject.prototype.getUserGroupItems = function () {
		if (!this.ObjectsDataSet)
            return null;

		return this.ObjectsDataSet.GetRelatedObjects(this, "UserGroupItems");							
	};

		
	Solid.Web.Model.DataObjects.GOUserObject.prototype.onUserGroupItemsChanged = function (change, newitems, olditems, dirtyhandlerOn) {
        if (change === "add") {
            for (var i = 0 ; i < newitems.length ;  i++) {
                if (this.Data.IsNew() === true) {
                    newitems[i].Data._user_NewObjectId(this.Data.InternalObjectId());
                } else {
					newitems[i].Data.GOUserId(this.Data.Id());
              }
            }

			if (newitems.length > 0 && dirtyhandlerOn === true)
				this.Data.IsDirty(true);
        }
        else if (change === "remove") {
            for (var i = 0 ; i < olditems.length ;  i++) {
                if ( olditems[i].Data.IsNew() === true) {
					this.ObjectsDataSet.RemoveObject(olditems[i]);
                }
            }

			if (olditems.length > 0 && dirtyhandlerOn === true)
				this.Data.IsDirty(true);
        }            
    };		
	Solid.Web.Model.DataObjects.GOUserObject.prototype.getUserRoleItems = function () {
		if (!this.ObjectsDataSet)
            return null;

		return this.ObjectsDataSet.GetRelatedObjects(this, "UserRoleItems");							
	};

		
	Solid.Web.Model.DataObjects.GOUserObject.prototype.onUserRoleItemsChanged = function (change, newitems, olditems, dirtyhandlerOn) {
        if (change === "add") {
            for (var i = 0 ; i < newitems.length ;  i++) {
                if (this.Data.IsNew() === true) {
                    newitems[i].Data._user_NewObjectId(this.Data.InternalObjectId());
                } else {
					newitems[i].Data.GOUserId(this.Data.Id());
              }
            }

			if (newitems.length > 0 && dirtyhandlerOn === true)
				this.Data.IsDirty(true);
        }
        else if (change === "remove") {
            for (var i = 0 ; i < olditems.length ;  i++) {
                if ( olditems[i].Data.IsNew() === true) {
					this.ObjectsDataSet.RemoveObject(olditems[i]);
                }
            }

			if (olditems.length > 0 && dirtyhandlerOn === true)
				this.Data.IsDirty(true);
        }            
    };		

	/*************************/
    /****** VALIDATION *******/
    /*************************/       

	Solid.Web.Model.DataObjects.GOUserObject.prototype.runValidation = function () {
		Solid.Web.Model.DataObjects.Validation.GOUserValidator.validate(this);
	};

	Solid.Web.Model.DataObjects.GOUserObject.prototype.resetValidation = function () {
		Solid.Web.Model.DataObjects.Validation.GOUserValidator.resetValidation(this);
	};


	/********************/
    /****** MODEL *******/
    /********************/
		
	Solid.Web.Model.DataObjects.GOUserObject.prototype.Clone = function() {
		var clone = new Solid.Web.Model.DataObjects.GOUserObject();
        clone.DirtyHandlerOn = false;
		clone.notifyChangesOn = false;
		clone.Data.InternalObjectId(this.Data.InternalObjectId());

		// Copy all fields
		clone.Data.Id_OldValue(this.Data.Id_OldValue());
		clone.Data.Id(this.Data.Id());
		clone.Data.Blocked(this.Data.Blocked());
		clone.Data.EmailAddress(this.Data.EmailAddress());
		clone.Data.EmailValidated(this.Data.EmailValidated());
		clone.Data.FirstName(this.Data.FirstName());
		clone.Data.FullName(this.Data.FullName());
		clone.Data.LastName(this.Data.LastName());
		clone.Data.Password(this.Data.Password());
		clone.Data.PasswordExpiry(this.Data.PasswordExpiry());
		clone.Data.Unregistered(this.Data.Unregistered());
		clone.Data.UserName(this.Data.UserName());
		clone.Data.UserValidated(this.Data.UserValidated());
		clone.contextIds = this.contextIds;

		clone.Data.IsDirty(this.Data.IsDirty());
		clone.Data.IsNew(this.Data.IsNew());
		clone.Data.IsMarkedForDeletion(this.Data.IsMarkedForDeletion());

        clone.DirtyHandlerOn = true;
		clone.notifyChangesOn = true;

		clone.updateDependentValues();

		return clone;
	};

	Solid.Web.Model.DataObjects.GOUserObject.prototype.CopyValuesFrom = function(sourceObject) {
        var oldDirtyHandlerOn = this.DirtyHandlerOn;
        var oldNotifyChangesOn = this.notifyChangesOn;
        this.DirtyHandlerOn = false;
		this.notifyChangesOn = false;

		if (sourceObject) {
			this.Data.InternalObjectId(sourceObject.Data.InternalObjectId());

			// Copy all fields
			this.Data.Id_OldValue(sourceObject.Data.Id_OldValue());
			this.Data.Id(sourceObject.Data.Id());
					this.Data.Blocked(sourceObject.Data.Blocked());
			this.Data.EmailAddress(sourceObject.Data.EmailAddress());
			this.Data.EmailValidated(sourceObject.Data.EmailValidated());
			this.Data.FirstName(sourceObject.Data.FirstName());
			this.Data.FullName(sourceObject.Data.FullName());
			this.Data.LastName(sourceObject.Data.LastName());
			this.Data.Password(sourceObject.Data.Password());
			this.Data.PasswordExpiry(sourceObject.Data.PasswordExpiry());
			this.Data.Unregistered(sourceObject.Data.Unregistered());
			this.Data.UserName(sourceObject.Data.UserName());
			this.Data.UserValidated(sourceObject.Data.UserValidated());
			this.contextIds = sourceObject.contextIds;

			this.Data.IsDirty(sourceObject.Data.IsDirty());
			this.Data.IsNew(sourceObject.Data.IsNew());
			this.Data.IsMarkedForDeletion(sourceObject.Data.IsMarkedForDeletion());
		}

        this.DirtyHandlerOn = oldDirtyHandlerOn;
        this.notifyChangesOn = oldNotifyChangesOn;

		this.updateDependentValues();
	};

	Solid.Web.Model.DataObjects.GOUserObject.prototype.updateDependentCustomValues = function () {
		if (this.isInUpdateDependentCustomValues === true || !this.notifyChangesOn)
		    return;
			
		this.isInUpdateDependentCustomValues = true;			
		this.isInUpdateDependentCustomValues = false;
	};
		
	Solid.Web.Model.DataObjects.GOUserObject.prototype.updateDependentValues = function() {
		if (!this.notifyChangesOn)
			return;
		
		// Initialize Business Rules ReadOnly
		this.updateIsUserNameReadOnlyValue();		
	};

	/*****************************/
    /****** INITIALIZATION *******/
    /*****************************/

	Solid.Web.Model.DataObjects.GOUserObject.prototype.initialize = function() {

		// Subscriptions
		this.subscriptions.push(this.Data.IsDirty.subscribe(isDirtySubscriptionHandler, this));
		this.subscriptions.push(this.Data.IsMarkedForDeletion.subscribe(isMarkedForDeletionSubscriptionHandler, this));
		this.subscriptions.push(this.Data.Blocked.subscribe(BlockedPropertySubscriptionHandler, this));
		this.subscriptions.push(this.Data.EmailAddress.subscribe(EmailAddressPropertySubscriptionHandler, this));
		this.subscriptions.push(this.Data.EmailValidated.subscribe(EmailValidatedPropertySubscriptionHandler, this));
		this.subscriptions.push(this.Data.FirstName.subscribe(FirstNamePropertySubscriptionHandler, this));
		this.subscriptions.push(this.Data.FullName.subscribe(FullNamePropertySubscriptionHandler, this));
		this.subscriptions.push(this.Data.Id.subscribe(IdPropertySubscriptionHandler, this));
		this.subscriptions.push(this.Data.LastName.subscribe(LastNamePropertySubscriptionHandler, this));
		this.subscriptions.push(this.Data.Password.subscribe(PasswordPropertySubscriptionHandler, this));
		this.subscriptions.push(this.Data.PasswordExpiry.subscribe(PasswordExpiryPropertySubscriptionHandler, this));
		this.subscriptions.push(this.Data.Unregistered.subscribe(UnregisteredPropertySubscriptionHandler, this));
		this.subscriptions.push(this.Data.UserName.subscribe(UserNamePropertySubscriptionHandler, this));
		this.subscriptions.push(this.Data.UserValidated.subscribe(UserValidatedPropertySubscriptionHandler, this));

		this.DirtyHandlerOn = false;
		this.notifyChangesOn = false;
		
		// Setting default values
		this.Data.UserValidated(false);
		this.Data.EmailValidated(false);
		this.Data.Blocked(false);
		this.Data.Unregistered(false);
		
		this.DirtyHandlerOn = true;
		this.notifyChangesOn = true;
 
		this.updateDependentValues();
	};

	Solid.Web.Model.DataObjects.GOUserObject.prototype.release = function() {			
		if (this.IsReleased)
			return;

		this.IsReleased = true;

		var i;
		for (i = 0; i < this.ko_computed.length; i++) {
			this.ko_computed[i].dispose();
		}
		
		for (i = 0; i < this.subscriptions.length; i++) {
			this.subscriptions[i].dispose();
		}

		// Resetting arrays for GC
		this.ko_computed = [];
		this.subscriptions = [];
	};


	/***************************************************************/
    /****** "PRIVATE" methods, FOR SUBSCRIPTIONS / COMPUTED ********/
    /***************************************************************/
		
	/// Computed functions
		
	function ComputedPKForGOUser() {
		return this.Data.Id();
	}	 
	
	function statusDataValidationComputed() {
		var isValid = true;
		isValid = isValid && this.StatusData.isBlockedValid() && this.StatusData.isEmailAddressValid() && this.StatusData.isEmailValidatedValid() && this.StatusData.isFirstNameValid() && this.StatusData.isFullNameValid() && this.StatusData.isIdValid() && this.StatusData.isLastNameValid() && this.StatusData.isPasswordValid() && this.StatusData.isPasswordExpiryValid() && this.StatusData.isUnregisteredValid() && this.StatusData.isUserNameValid() && this.StatusData.isUserValidatedValid() && this.StatusData.isGOUserEntityValid();
		return isValid;
	}

	function formatDateForPasswordExpiry() { return GO.DateToString(this.getTimezoneAdjustedDate("PasswordExpiry", false), false); }	
	function formatDateForPasswordExpiryWithTime() { return GO.DateToString(this.getTimezoneAdjustedDate("PasswordExpiry", false), true); }
	
	/// Subscription handler
	function isDirtySubscriptionHandler(newValue) {
		if (newValue === true && this.ObjectsDataSet) {
			this.ObjectsDataSet.setContextIdsDirty(this.contextIds);
		}		
	}

	function isMarkedForDeletionSubscriptionHandler(newValue) {
		this.Data.IsDirty(true);
	}
			

	function BlockedPropertySubscriptionHandler(newValue) {
		
		if (this.DirtyHandlerOn) {			
            this.Data.IsDirty(true);
		}
 
		if (this.notifyChangesOn) {		
			this.updateDependentCustomValues();
			this.onPropertyChanged("Blocked");
		}
    }

	function EmailAddressPropertySubscriptionHandler(newValue) {
		
		if (this.DirtyHandlerOn) {			
            this.Data.IsDirty(true);
		}
 
		if (this.notifyChangesOn) {		
			this.updateDependentCustomValues();
			this.onPropertyChanged("EmailAddress");
		}
    }

	function EmailValidatedPropertySubscriptionHandler(newValue) {
		
		if (this.DirtyHandlerOn) {			
            this.Data.IsDirty(true);
		}
 
		if (this.notifyChangesOn) {		
			this.updateDependentCustomValues();
			this.onPropertyChanged("EmailValidated");
		}
    }

	function FirstNamePropertySubscriptionHandler(newValue) {
		
		if (this.DirtyHandlerOn) {			
            this.Data.IsDirty(true);
		}
 
		if (this.notifyChangesOn) {		
			this.updateDependentCustomValues();
			this.onPropertyChanged("FirstName");
		}
    }

	function FullNamePropertySubscriptionHandler(newValue) {
		
		if (this.DirtyHandlerOn) {			
            this.Data.IsDirty(true);
		}
 
		if (this.notifyChangesOn) {		
			this.updateDependentCustomValues();
			this.onPropertyChanged("FullName");
		}
    }

	function IdPropertySubscriptionHandler(newValue) {
		// PK Changed => update dataset internalId table (don't do it if new object)
		if (this.Data.IsNew() === false && !this.isDataSetCopy && this.Data.Id_OldValue() !== newValue) {
			if (this.ObjectsDataSet) {
				this.ObjectsDataSet.getGOUserObjectsDataSet().gOUserObjectInternalIds[newValue] = this.ObjectsDataSet.getGOUserObjectsDataSet().gOUserObjectInternalIds[this.Data.Id_OldValue()];
				delete this.ObjectsDataSet.getGOUserObjectsDataSet().gOUserObjectInternalIds[this.Data.Id_OldValue()];
			}
		}
		
		this.Data.Id_OldValue(newValue);
		
		if (this.DirtyHandlerOn) {			
            this.Data.IsDirty(true);
		}
 
		if (this.notifyChangesOn) {		
			this.updateDependentCustomValues();
			this.onPropertyChanged("Id");
		}
    }

	function LastNamePropertySubscriptionHandler(newValue) {
		
		if (this.DirtyHandlerOn) {			
            this.Data.IsDirty(true);
		}
 
		if (this.notifyChangesOn) {		
			this.updateDependentCustomValues();
			this.onPropertyChanged("LastName");
		}
    }

	function PasswordPropertySubscriptionHandler(newValue) {
		
		if (this.DirtyHandlerOn) {			
            this.Data.IsDirty(true);
		}
 
		if (this.notifyChangesOn) {		
			this.updateDependentCustomValues();
			this.onPropertyChanged("Password");
		}
    }

	function PasswordExpiryPropertySubscriptionHandler(newValue) {
		
		if (this.DirtyHandlerOn) {			
            this.Data.IsDirty(true);
		}
 
		if (this.notifyChangesOn) {		
			this.updateDependentCustomValues();
			this.onPropertyChanged("PasswordExpiry");
		}
    }

	function UnregisteredPropertySubscriptionHandler(newValue) {
		
		if (this.DirtyHandlerOn) {			
            this.Data.IsDirty(true);
		}
 
		if (this.notifyChangesOn) {		
			this.updateDependentCustomValues();
			this.onPropertyChanged("Unregistered");
		}
    }

	function UserNamePropertySubscriptionHandler(newValue) {
		
		if (this.DirtyHandlerOn) {			
            this.Data.IsDirty(true);
		}
 
		if (this.notifyChangesOn) {		
			this.updateDependentCustomValues();
			this.onPropertyChanged("UserName");
		}
    }

	function UserValidatedPropertySubscriptionHandler(newValue) {
		
		if (this.DirtyHandlerOn) {			
            this.Data.IsDirty(true);
		}
 
		if (this.notifyChangesOn) {		
			this.updateDependentCustomValues();
			this.onPropertyChanged("UserValidated");
		}
    }

 


 



	/*************************/
    /****** FACTORY **********/
    /*************************/

    Solid.Web.Model.DataObjects.GOUserObjectFactory = {
        createNew: function (objectsDataSet, contextId) {
            // if there is a custom implementation => call it
			if (Solid.Web.Model.DataObjects.GOUserObjectFactoryCustom) {
                return Solid.Web.Model.DataObjects.GOUserObjectFactoryCustom.createNew(objectsDataSet, contextId);
            }
            else {
                var newObject = new Solid.Web.Model.DataObjects.GOUserObject();

                if (contextId) {
                    newObject.contextIds.push(contextId);
                }

                if (objectsDataSet) {
                    objectsDataSet.AddObject(newObject);

					if (contextId)
						objectsDataSet.setContextIdsDirty(newObject.contextIds);

                }

                return newObject;
            }
        }
    };

	if (window.ApplicationSourceHandler)
		window.ApplicationSourceHandler.onSourceLoaded("/Model/DataObjects/GOUserObject.js");

} ());